<!DOCTYPE html>
  <meta charset="utf-8">
              
  <!-- Load d3.js -->
  <!--<script type="text/javascript" src="d3.js"></script>-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>
  
  <style>
  .node {
    stroke: #fff;
    stroke-width: 1.5px;
  }
  
  .nodelabel {
  font-family: "arial";
  font-size: 20px;
  }
  
  .link {
    stroke: #999;
    stroke-opacity: .6;
  }
  

  </style>
  	
  <body>
  	<script>
  	
  	
  	var width =5000,
  		height =5000;
            
            
            // The color functions: in this example I'm coloring all the convex hulls at the same layer the same to more easily see the result.
		var color = d3.scale.category20();
              color(0);
              color(1);
              color(2);
              color(3);
              color(4);
              color(5);
              color(6);
              color(7);
              color(8);
              color(9);
			        color(10);
              color(11);
              color(12);
              color(13);
              color(14);
              color(15);
              color(16);
              color(17);
              color(18);
              color(19);
          groupHullColor1 = '#1B9E77' ;
groupHullColor2 = '#D95F02' ;
groupHullColor3 = '#7570B3' ;
groupHullColor4 = '#E7298A' ;
groupHullColor5 = '#66A61E' ;
groupHullColor6 = '#E6AB02' ;
groupHullColor7 = '#A6761D' ;
groupHullColor8 = '#666666' ;
groupHullColor9 = '#7FC97F' ;
var force = d3.layout.force()
    .charge(-120)
    .linkDistance(30)
    .size([width, height]);

var zoomFlag = 0;

var zoomFlag = 0;
		var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height)
			.attr("transform", "translate(5.684341886080802e-14,5.684341886080802e-14) scale(0.9999999999999999)") //TODO

			.call(d3.behavior.zoom().on("zoom", function () {
			svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
			//alert(d3.event.scale)
			if (!zoomFlag && d3.event.scale < 0.6){
				var nodelabels = g.selectAll(".nodelabel")
				nodelabels.text("")
				zoomFlag = 1
			}
			if (zoomFlag && d3.event.scale > 0.6){
				var nodelabels = g.selectAll(".nodelabel")
				.text(function(d){return d.name;});
				zoomFlag = 0
			}
		  }))
		  
  .on("dblclick.zoom", null)
  .on("mousedown.zoom", null)
  .append("g");
  
var g = d3.select("g");

// propertyValue depicts the size of the node while value the edge width, 'fixed': true to disable bouncy physics
var theGraphData = {
"nodes":[
{"id":0,name:"","propertyValue":2,'x':392.317934191413, 'y':344.240971110086, 'fixed': true, "color_value":6},
{"id":1,name:"","propertyValue":2,'x':436.56615929327, 'y':258.935501196554, 'fixed': true, "color_value":6},
{"id":2,name:"","propertyValue":2,'x':720, 'y':334.86285336641, 'fixed': true, "color_value":6},
{"id":3,name:"","propertyValue":2,'x':447.783677179763, 'y':343.310613744092, 'fixed': true, "color_value":6},
{"id":4,name:"","propertyValue":2,'x':382.36059559814, 'y':224.629206688253, 'fixed': true, "color_value":6},
{"id":5,name:"","propertyValue":2,'x':433.244248525162, 'y':308.000674593975, 'fixed': true, "color_value":6},
{"id":6,name:"","propertyValue":2,'x':413.973135657866, 'y':131.209878244462, 'fixed': true, "color_value":0},
{"id":7,name:"","propertyValue":2,'x':308.984955762523, 'y':598.036314750356, 'fixed': true, "color_value":6},
{"id":8,name:"","propertyValue":2,'x':394.384753984129, 'y':293.430046377, 'fixed': true, "color_value":6},
{"id":9,name:"","propertyValue":2,'x':356.054910072269, 'y':399.05683379297, 'fixed': true, "color_value":0},
{"id":10,name:"","propertyValue":2,'x':423.956121993449, 'y':355.70423754303, 'fixed': true, "color_value":6},
{"id":11,name:"","propertyValue":2,'x':453.172673653075, 'y':393.771639219236, 'fixed': true, "color_value":6},
{"id":12,name:"","propertyValue":2,'x':459.10937771949, 'y':292.086256463316, 'fixed': true, "color_value":6},
{"id":13,name:"","propertyValue":2,'x':513.634773805982, 'y':430.573009519, 'fixed': true, "color_value":6},
{"id":14,name:"","propertyValue":2,'x':547.350584795969, 'y':130.807650649032, 'fixed': true, "color_value":0},
{"id":15,name:"","propertyValue":2,'x':581.777143138913, 'y':332.105612149833, 'fixed': true, "color_value":6},
{"id":16,name:"","propertyValue":2,'x':625.656507489915, 'y':515.410528951389, 'fixed': true, "color_value":6},
{"id":17,name:"","propertyValue":2,'x':434.345040083855, 'y':676.056127646719, 'fixed': true, "color_value":6},
{"id":18,name:"","propertyValue":2,'x':627.263676581054, 'y':213.14688940129, 'fixed': true, "color_value":6},
{"id":19,name:"","propertyValue":2,'x':412.336842303602, 'y':425.591185415698, 'fixed': true, "color_value":0},
{"id":20,name:"","propertyValue":2,'x':611.624037905686, 'y':720, 'fixed': true, "color_value":6},
{"id":21,name:"","propertyValue":2,'x':506.298332230395, 'y':580.164828561828, 'fixed': true, "color_value":6},
{"id":22,name:"","propertyValue":2,'x':112.371802376515, 'y':20, 'fixed': true, "color_value":0},
{"id":23,name:"","propertyValue":2,'x':214.437087082746, 'y':389.600752106497, 'fixed': true, "color_value":6},
{"id":24,name:"","propertyValue":2,'x':322.469440857484, 'y':292.107584295568, 'fixed': true, "color_value":6},
{"id":25,name:"","propertyValue":2,'x':20, 'y':532.660728536222, 'fixed': true, "color_value":6},
],
  "links":[
{"source":14,"target":21,"value":1},
{"source":14,"target":13,"value":1},
{"source":14,"target":18,"value":1},
{"source":14,"target":15,"value":1},
{"source":14,"target":17,"value":1},
{"source":14,"target":19,"value":1},
{"source":16,"target":13,"value":1},
{"source":16,"target":20,"value":1},
{"source":16,"target":15,"value":1},
{"source":16,"target":17,"value":1},
{"source":21,"target":13,"value":1},
{"source":21,"target":18,"value":1},
{"source":21,"target":0,"value":1},
{"source":21,"target":15,"value":1},
{"source":21,"target":19,"value":1},
{"source":13,"target":1,"value":1},
{"source":13,"target":18,"value":1},
{"source":13,"target":5,"value":1},
{"source":13,"target":4,"value":1},
{"source":13,"target":24,"value":1},
{"source":13,"target":15,"value":1},
{"source":13,"target":17,"value":1},
{"source":13,"target":19,"value":1},
{"source":1,"target":11,"value":1},
{"source":1,"target":3,"value":1},
{"source":1,"target":12,"value":1},
{"source":1,"target":0,"value":1},
{"source":1,"target":4,"value":1},
{"source":1,"target":24,"value":1},
{"source":1,"target":10,"value":1},
{"source":1,"target":8,"value":1},
{"source":18,"target":15,"value":1},
{"source":18,"target":19,"value":1},
{"source":20,"target":17,"value":1},
{"source":5,"target":3,"value":1},
{"source":5,"target":12,"value":1},
{"source":5,"target":0,"value":1},
{"source":5,"target":10,"value":1},
{"source":5,"target":8,"value":1},
{"source":11,"target":9,"value":1},
{"source":11,"target":3,"value":1},
{"source":11,"target":24,"value":1},
{"source":11,"target":15,"value":1},
{"source":11,"target":19,"value":1},
{"source":11,"target":8,"value":1},
{"source":9,"target":12,"value":1},
{"source":9,"target":4,"value":1},
{"source":9,"target":25,"value":1},
{"source":9,"target":6,"value":1},
{"source":9,"target":24,"value":1},
{"source":3,"target":12,"value":1},
{"source":3,"target":0,"value":1},
{"source":3,"target":4,"value":1},
{"source":3,"target":23,"value":1},
{"source":3,"target":24,"value":1},
{"source":3,"target":15,"value":1},
{"source":3,"target":10,"value":1},
{"source":3,"target":19,"value":1},
{"source":3,"target":8,"value":1},
{"source":12,"target":0,"value":1},
{"source":12,"target":4,"value":1},
{"source":12,"target":24,"value":1},
{"source":12,"target":2,"value":1},
{"source":12,"target":10,"value":1},
{"source":12,"target":19,"value":1},
{"source":12,"target":8,"value":1},
{"source":0,"target":4,"value":1},
{"source":0,"target":24,"value":1},
{"source":0,"target":22,"value":1},
{"source":0,"target":15,"value":1},
{"source":0,"target":10,"value":1},
{"source":0,"target":8,"value":1},
{"source":4,"target":23,"value":1},
{"source":4,"target":24,"value":1},
{"source":4,"target":2,"value":1},
{"source":4,"target":10,"value":1},
{"source":4,"target":19,"value":1},
{"source":4,"target":8,"value":1},
{"source":23,"target":6,"value":1},
{"source":23,"target":24,"value":1},
{"source":23,"target":19,"value":1},
{"source":25,"target":24,"value":1},
{"source":6,"target":24,"value":1},
{"source":24,"target":22,"value":1},
{"source":24,"target":10,"value":1},
{"source":24,"target":19,"value":1},
{"source":24,"target":8,"value":1},
{"source":15,"target":19,"value":1},
{"source":10,"target":8,"value":1},
]
}

graph = theGraphData

// The data for grouping nodes.
// The groups are not partitions, some nodes belong to more than one group.
var group1 = [[0,1,2,3,4,5,6,7,8,9,10,11,12]],
group2 = [[13,14,15,16,17,18,19,20,21]],
group3 = [[10,12,0,5]],
group4 = [[11,12,3,1,19,10,0,8,5]],
group5 = [[1,11,10,5,3,8]],
group6 = [[5,0,10,22]],
group7 = [[6,23,9,24]],
group8 = [[23,25,9,24]],
group9 = [[4,19]];
var groupNodes1 = group1.map(function(group1,index){
  return group1.map(function(member){return graph.nodes[member] });
  });
var groupNodes2 = group2.map(function(group2,index){
  return group2.map(function(member){return graph.nodes[member] });
  });
var groupNodes3 = group3.map(function(group3,index){
  return group3.map(function(member){return graph.nodes[member] });
  });
var groupNodes4 = group4.map(function(group4,index){
  return group4.map(function(member){return graph.nodes[member] });
  });
var groupNodes5 = group5.map(function(group5,index){
  return group5.map(function(member){return graph.nodes[member] });
  });
var groupNodes6 = group6.map(function(group6,index){
  return group6.map(function(member){return graph.nodes[member] });
  });
var groupNodes7 = group7.map(function(group7,index){
  return group7.map(function(member){return graph.nodes[member] });
  });
var groupNodes8 = group8.map(function(group8,index){
  return group8.map(function(member){return graph.nodes[member] });
  });
var groupNodes9 = group9.map(function(group9,index){
  return group9.map(function(member){return graph.nodes[member] });
  });

var groupPath = function(d) {
    var fakePoints = [];  
    if (d.length == 1 || d.length == 2) {     // This adjusts convex hulls for groups with fewer than 3 nodes by adding virtual nodes.
       fakePoints = [ [d[0].x + 0.001, d[0].y - 0.001],[d[0].x - 0.001, d[0].y + 0.001],[d[0].x - 0.001, d[0].y + 0.001]]; }     
    d.forEach(function(element) { fakePoints = fakePoints.concat([   // "0.7071" is the sine and cosine of 45 degree for corner points.
           [(element.x), (element.y + (2 + (4 * element.propertyValue)))],
           [(element.x + 0.7071 * (2 + (4 * element.propertyValue))), (element.y + 0.7071 * (2 + (4 * element.propertyValue)))],
           [(element.x + (2 + (4 * element.propertyValue))), (element.y)],
           [(element.x + 0.7071 * (2 + (4 * element.propertyValue))), (element.y - 0.7071 * (2 + (4 * element.propertyValue)))],
           [(element.x), (element.y - (2 + (4 * element.propertyValue)))],
           [(element.x - 0.7071 * (2 + (4 * element.propertyValue))), (element.y - 0.7071 * (2 + (4 * element.propertyValue)))],
           [(element.x - (2 + (4 * element.propertyValue))), (element.y)],
           [(element.x - 0.7071 * (2 + (4 * element.propertyValue))), (element.y + 0.7071 * (2 + (4 * element.propertyValue)))]
    ]); })
    return "M" + d3.geom.hull( fakePoints ).join("L") + "Z";
};

var groupHullFill1 = function(d, i) { return groupHullColor1; };
var groupHullFill2 = function(d, i) { return groupHullColor2; };
var groupHullFill3 = function(d, i) { return groupHullColor3; };
var groupHullFill4 = function(d, i) { return groupHullColor4; };
var groupHullFill5 = function(d, i) { return groupHullColor5; };
var groupHullFill6 = function(d, i) { return groupHullColor6; };
var groupHullFill7 = function(d, i) { return groupHullColor7; };
var groupHullFill8 = function(d, i) { return groupHullColor8; };
var groupHullFill9 = function(d, i) { return groupHullColor9; };
force
.nodes(graph.nodes)
.links(graph.links)
.start();

var link = g.selectAll(".link")
    .data(graph.links)
	.enter().append("line")
    .attr("class", "link")
    .style("stroke-width", function(d) { return Math.sqrt(d.value); });

var node = g.selectAll(".node")
    .data(graph.nodes)
	.enter().append("circle")
    .attr("class", "node")
    .attr("r", function(d) { return 2 + (4 * d.propertyValue); })
	  .style("fill", function(d) { return color(d.color_value); })
    .style("stroke-width", 1.5)
    .call(force.drag);
  
//node.append("title")
//  .text(function(d) { return d.name; });
    
var nodelabels = svg.selectAll(".nodelabel") 
  .data(graph.nodes)
  .enter()
  .append("text")
  .attr({"x":function(d){return d.x;},
        "y":function(d){return d.y;},
        "class":"nodelabel",
        "stroke":"black"})
  .text(function(d){return d.name;});

force.on("tick", function() {
    // this updates the links, but they are UNDER the convex hulls because the hulls are recreated every tick
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
        
    nodelabels.attr("x", function(d) { return d.x; }) 
        .attr("y", function(d) { return d.y+3; }); 
                  
    // this updates the convex hulls
    g.selectAll("path").remove()
    
                  

  g.selectAll("path#group1")
  .data(groupNodes1)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill1)
  .style("stroke", groupHullFill1)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);


  g.selectAll("path#group2")
  .data(groupNodes2)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill2)
  .style("stroke", groupHullFill2)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);


  g.selectAll("path#group3")
  .data(groupNodes3)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill3)
  .style("stroke", groupHullFill3)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);


  g.selectAll("path#group4")
  .data(groupNodes4)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill4)
  .style("stroke", groupHullFill4)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);


  g.selectAll("path#group5")
  .data(groupNodes5)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill5)
  .style("stroke", groupHullFill5)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);


  g.selectAll("path#group6")
  .data(groupNodes6)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill6)
  .style("stroke", groupHullFill6)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);


  g.selectAll("path#group7")
  .data(groupNodes7)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill7)
  .style("stroke", groupHullFill7)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);


  g.selectAll("path#group8")
  .data(groupNodes8)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill8)
  .style("stroke", groupHullFill8)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);


  g.selectAll("path#group9")
  .data(groupNodes9)
  .attr("d", groupPath)
  .enter().insert("path", "circle")
  .style("fill", groupHullFill9)
  .style("stroke", groupHullFill9)
  .style("stroke-width", 35)
  .style("stroke-linejoin", "round")
  .style("opacity", .2)
  .attr("ID","group")
  .attr("d", groupPath);

 });
 

	</script>
</body>
